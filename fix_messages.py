#!/usr/bin/env python
# -*- coding: utf-8 -*-

import os
import sys

def fix_messages():
    """
    u0418u0441u043fu0440u0430u0432u043bu044fu0435u0442 u0442u0435u043au0441u0442 u0441u043eu043eu0431u0449u0435u043du0438u0439 u0434u043bu044f u043du0435u0430u0432u0442u043eu0440u0438u0437u043eu0432u0430u043du043du044bu0445 u043fu043eu043bu044cu0437u043eu0432u0430u0442u0435u043bu0435u0439
    """
    print("\n===== u0418u0421u041fu0420u0410u0412u041bu0415u041du0418u0415 u0422u0415u041au0421u0422u0410 u0421u041eu041eu0411u0429u0415u041du0418u0419 =====\n")
    
    # u041fu0443u0442u044c u043a u0444u0430u0439u043bu0443 bot.py
    bot_py_path = os.path.join(os.path.dirname(os.path.abspath(__file__)), 'bot.py')
    
    # u041fu0440u043eu0432u0435u0440u044fu0435u043c, u0441u0443u0449u0435u0441u0442u0432u0443u0435u0442 u043bu0438 u0444u0430u0439u043b
    if not os.path.exists(bot_py_path):
        print(f"\nu041eu0448u0438u0431u043au0430: u0444u0430u0439u043b {bot_py_path} u043du0435 u043du0430u0439u0434u0435u043d")
        return
    
    try:
        # u0421u043eu0437u0434u0430u0435u043c u0440u0435u0437u0435u0440u0432u043du0443u044e u043au043eu043fu0438u044e bot.py
        backup_path = bot_py_path + '.messages.bak'
        with open(bot_py_path, 'r', encoding='utf-8') as f_in, open(backup_path, 'w', encoding='utf-8') as f_out:
            f_out.write(f_in.read())
        
        print(f"  - u0421u043eu0437u0434u0430u043du0430 u0440u0435u0437u0435u0440u0432u043du0430u044f u043au043eu043fu0438u044f {backup_path}")
        
        # u0427u0438u0442u0430u0435u043c u0444u0430u0439u043b bot.py
        with open(bot_py_path, 'r', encoding='utf-8') as f:
            content = f.read()
        
        # u041du043eu0432u044bu0439 u0442u0435u043au0441u0442 u0441u043eu043eu0431u0449u0435u043du0438u044f u0434u043bu044f u043du0435u0430u0432u0442u043eu0440u0438u0437u043eu0432u0430u043du043du044bu0445 u043fu043eu043bu044cu0437u043eu0432u0430u0442u0435u043bu0435u0439
        new_message = 'u0414u043bu044f u0434u043eu0441u0442u0443u043fu0430 u043a u0437u0430u043fu0438u0441u044fu043c u043du0443u0436u043du043e u0431u044bu0442u044c u0443u0447u0430u0441u0442u043du0438u043au043eu043c u0433u0440u0443u043fu043fu044b. u0415u0441u043bu0438 u0442u044b u0435u0441u0442u044c u0432 u0433u0440u0443u043fu043fu0435 u0438 u0443 u0442u0435u0431u044f u043du0435u0442 u0434u043eu0441u0442u0443u043fu0430, u043fu043eu0436u0430u043bu0443u0439u0441u0442u0430, u043du0430u043fu0438u0448u0438 @tovlad.'
        
        # 1. u0418u0441u043fu0440u0430u0432u043bu044fu0435u043c u043au043eu043du0441u0442u0430u043du0442u0443 MSG_NOT_AUTHORIZED
        old_msg_not_authorized = "MSG_NOT_AUTHORIZED = 'u0414u043bu044f u0434u043eu0441u0442u0443u043fu0430 u043a u0431u043eu0442u0443 u043du0435u043eu0431u0445u043eu0434u0438u043cu043e u0437u0430u0440u0435u0433u0438u0441u0442u0440u0438u0440u043eu0432u0430u0442u044cu0441u044f. u041fu043eu0436u0430u043bu0443u0439u0441u0442u0430, u043eu0431u0440u0430u0442u0438u0441u044c u043a @tovlad.'"
        new_msg_not_authorized = f"MSG_NOT_AUTHORIZED = '{new_message}'"
        
        content = content.replace(old_msg_not_authorized, new_msg_not_authorized)
        print("  - u0418u0441u043fu0440u0430u0432u043bu0435u043du0430 u043au043eu043du0441u0442u0430u043du0442u0430 MSG_NOT_AUTHORIZED")
        
        # 2. u0418u0441u043fu0440u0430u0432u043bu044fu0435u043c u0441u043eu043eu0431u0449u0435u043du0438u0435 u0432 u0444u0443u043du043au0446u0438u0438 start
        old_start_message = "f'u041fu0440u0438u0432u0435u0442, {first_name}! u0414u043bu044f u0434u043eu0441u0442u0443u043fu0430 u043a u0431u043eu0442u0443 u043du0435u043eu0431u0445u043eu0434u0438u043cu043e u0431u044bu0442u044c u0437u0430u0440u0435u0433u0438u0441u0442u0440u0438u0440u043eu0432u0430u043du043du044bu043c u0441u0442u0443u0434u0435u043du0442u043eu043c. '"
        old_start_message_2 = "'u041fu043eu0436u0430u043bu0443u0439u0441u0442u0430, u043eu0431u0440u0430u0442u0438u0442u0435u0441u044c u043a u0430u0434u043cu0438u043du0438u0441u0442u0440u0430u0442u043eu0440u0443 u043au0438u043du043eu0448u043au043eu043bu044b u0434u043bu044f u0440u0435u0433u0438u0441u0442u0440u0430u0446u0438u0438.'"
        
        new_start_message = f"f'u041fu0440u0438u0432u0435u0442, {{first_name}}! {new_message}'"
        
        # u0417u0430u043cu0435u043du044fu0435u043c u043eu0431u0430 u0441u0442u0440u043eu043au0438 u0432 u043eu0434u043du0443
        content = content.replace(old_start_message + '\n            ' + old_start_message_2, new_start_message)
        print("  - u0418u0441u043fu0440u0430u0432u043bu0435u043du043e u0441u043eu043eu0431u0449u0435u043du0438u0435 u0432 u0444u0443u043du043au0446u0438u0438 start")
        
        # u0417u0430u043fu0438u0441u044bu0432u0430u0435u043c u0438u0437u043cu0435u043du0435u043du0438u044f u0432 u0444u0430u0439u043b
        with open(bot_py_path, 'w', encoding='utf-8') as f:
            f.write(content)
        
        print("\nu0422u0435u043au0441u0442 u0441u043eu043eu0431u0449u0435u043du0438u0439 u0443u0441u043fu0435u0448u043du043e u0438u0441u043fu0440u0430u0432u043bu0435u043d")
        print(f"\nu041du043eu0432u044bu0439 u0442u0435u043au0441u0442 u0441u043eu043eu0431u0449u0435u043du0438u044f: '{new_message}'")
        
    except Exception as e:
        print(f"\nu041eu0448u0438u0431u043au0430 u043fu0440u0438 u0438u0441u043fu0440u0430u0432u043bu0435u043du0438u0438 u0442u0435u043au0441u0442u0430 u0441u043eu043eu0431u0449u0435u043du0438u0439: {e}")
    
    print("\n===== u0418u0421u041fu0420u0410u0412u041bu0415u041du0418u0415 u0422u0415u041au0421u0422u0410 u0421u041eu041eu0411u0429u0415u041du0418u0419 u0417u0410u0412u0415u0420u0428u0415u041du041e =====\n")

def main():
    fix_messages()

if __name__ == "__main__":
    main()
